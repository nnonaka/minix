# $NetBSD: Makefile,v 1.12 2022/04/02 11:16:07 skrll Exp $

PROG=		bootia32.efi
OBJFMT=		pei-i386
NEWVERSWHAT=	"efiboot (ia32)"
CPUFLAGS=	-march=i686 -mtune=i686
GNUEFIARCH=	ia32
LIBKERN_ARCH=	i386
LIBGNUEFI_ARCH=	i386
KLINK_MACHINE=	i386
#OBJCOPY_FORMAT=	-O binary

EFIBOOT_ACPI=	yes
EFIBOOT_FDT=	yes
EFIBOOT_MULTIBOOT2=	yes

EXTRA_SOURCES=	efibootia32.c
EXTRA_SOURCES+=	startprog32.S
EXTRA_SOURCES+=	multiboot32.S

#CFLAGS+=	-m32 -DACPI_32BIT_PHYSICAL_ADDRESS
#AFLAGS+=	-m32
CPPFLAGS+=	-DEFIBOOT_ALLOCATE_MAX_ADDRESS=0x100000000ULL
CFLAGS+=	-DACPI_32BIT_PHYSICAL_ADDRESS
CFLAGS+=	-DEFIBOOT_ALIGN=0x200000
CFLAGS+=	-DEFIBOOT_MODULE_MACHINE=\"i386\"

.include "${.CURDIR}/../Makefile.efiboot"

release: check_RELEASEDIR
	${HOST_INSTALL_FILE} -m ${BINMODE} ${PROG} \
		${RELEASEDIR}/${RELEASEMACHINEDIR}/installation/misc
